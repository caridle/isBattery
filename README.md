# isBattery - 电源监控程序

一个基于Rust和Tauri开发的Windows电源状态监控工具，具备图形界面、系统托盘和智能提醒功能。

## 功能特性

### 🔋 核心监控功能
- **实时电源状态检测**：每10秒自动检测电源连接状态
- **电池电量监控**：实时显示电池电量百分比
- **功率负载监控**：实时显示当前系统功耗（瓦特数）
- **剩余时间估算**：基于当前功耗计算电池剩余使用时间
- **智能状态判断**：区分外接电源、电池供电、充电状态

### ⚠️ 智能提醒系统
- **电源断开提醒**：橙色背景窗口，提示连接电源适配器
- **低电量提醒**：红色背景窗口，电量低于阈值时提醒（默认20%）
- **优先级设计**：低电量提醒优先级高于电源断开提醒
- **声音提醒**：可配置的系统警告音或自定义音效
- **自动关闭**：电源重新连接或电量恢复后自动关闭提醒

### 🖥️ 系统托盘功能
- **状态图标**：
  - 🟢 绿色充电图标（电源已连接）
  - 🟠 橙色/红色电池图标（电池供电）
  - ⚫ 灰色图标（程序暂停）
- **右键菜单**：
  - 显示当前电源状态、电池电量和实时功耗
  - 设置界面快速访问
  - 暂停/恢复监控功能
  - 开机启动开关
  - 程序信息和退出选项

### ⚙️ 丰富的设置选项
- **监控设置**：
  - 检测间隔调整（5-3600秒）
  - 低电量阈值配置（5-50%）
  - 声音提醒开关
  - 自动关闭提醒设置
- **界面设置**：
  - 提醒窗口颜色自定义
  - 窗口透明度调节
  - 窗口置顶选项
- **系统设置**：
  - 开机自启动
  - 最小化到托盘

### 🔧 暂停功能
- **智能暂停**：临时停止电源检测，不影响系统运行
- **一键恢复**：手动恢复监控，确保用户控制
- **状态指示**：托盘图标变灰，清晰显示暂停状态

## 安装和使用

### 系统要求
- Windows 10/11
- .NET Framework 4.7.2 或更高版本（通常系统自带）

### 安装步骤

1. **编译安装**（推荐开发者）：
   ```bash
   # 确保已安装 Rust 和 Node.js
   git clone <repository>
   cd isBattery
   
   # 安装 Tauri CLI
   cargo install tauri-cli
   
   # 开发模式运行
   cargo tauri dev
   
   # 构建发布版本
   cargo tauri build
   ```

2. **直接下载**：
   - 从 Releases 页面下载预编译的安装包
   - 运行安装程序并按提示操作

### 首次使用

1. **启动程序**：
   - 程序启动后会自动最小化到系统托盘
   - 在任务栏右下角找到电池图标

2. **基本配置**：
   - 右键点击托盘图标选择"设置"
   - 根据需要调整检测间隔和低电量阈值
   - 开启开机自启动（推荐）

3. **测试功能**：
   - 在设置界面点击"测试音频"验证声音提醒
   - 拔掉电源适配器测试提醒功能

## 配置文件

配置文件位置：`%APPDATA%\\isBattery\\config.toml`

```toml
[monitoring]
check_interval = 10  # 检测间隔（秒）
sound_enabled = true  # 是否启用声音
auto_close_alert = true  # 电源连接后自动关闭提醒
low_battery_threshold = 20  # 低电量阈值（百分比）

[ui]
alert_color = \"#FF6B35\"  # 电源断开提醒窗口颜色
low_battery_color = \"#FF0000\"  # 低电量提醒窗口颜色
window_opacity = 0.95  # 窗口透明度
always_on_top = true  # 窗口置顶

[system]
auto_startup = false  # 开机自启动
minimize_to_tray = true  # 最小化到托盘
```

## 常见问题

### Q: 程序可以在后台运行吗？
A: 是的，程序设计为后台运行，关闭设置窗口不会退出程序，只是隐藏到托盘。

### Q: 如何完全退出程序？
A: 右键点击托盘图标，选择"退出"，或在设置界面使用 Alt+F4。

### Q: 提醒窗口太频繁怎么办？
A: 可以在设置中调整检测间隔，或使用"暂停提醒"功能临时停止监控。

### Q: 可以自定义提醒颜色吗？
A: 可以，在设置的"界面设置"标签页中可以自定义不同类型提醒的背景颜色。

### Q: 程序占用资源多吗？
A: 程序采用低资源占用设计，正常情况下CPU占用<1%，内存占用<50MB。

## 技术架构

- **编程语言**：Rust 2021 Edition
- **GUI框架**：Tauri 1.x（基于Web技术的现代GUI）
- **系统API**：Windows API（电源状态检测）
- **音频支持**：Rodio（跨平台音频播放）
- **配置管理**：TOML格式配置文件
- **自启动**：auto-launch（跨平台启动管理）

## 开发

### 项目结构
```
src/
├── main.rs              # 程序入口和主要逻辑
├── power/               # 电源检测模块
│   ├── detector.rs      # 电源状态检测
│   └── monitor.rs       # 监控服务
├── ui/                  # 用户界面模块
│   ├── tray.rs         # 托盘管理
│   ├── alert.rs        # 提醒窗口
│   ├── settings.rs     # 设置界面
│   └── icons.rs        # 图标资源
├── config/              # 配置管理模块
│   ├── manager.rs      # 配置管理器
│   └── storage.rs      # 配置存储
├── audio/               # 音频模块
│   └── player.rs       # 音效播放
└── utils/               # 工具模块
    ├── startup.rs      # 自启动管理
    └── logger.rs       # 日志记录
```

### 本地开发
```bash
# 安装依赖
cargo check

# 运行测试
cargo test

# 开发模式
cargo tauri dev

# 构建发布版
cargo tauri build
```

## 许可证

本项目采用 MIT 许可证 - 详见 [LICENSE](LICENSE) 文件。

## 贡献

欢迎提交 Issue 和 Pull Request！

## 更新日志

### v0.1.0
- 基础电源监控功能
- 实时功率负载监控和显示
- 动态功耗检测（基于系统负载）
- 智能电池剩余时间估算
- 托盘图标和菜单
- 提醒窗口系统
- 配置管理
- 开机自启动
- 暂停/恢复功能

---

**注意**：这是一个Windows专用程序，需要Windows 10或更高版本系统。